@@include('./partials/html.html')

<head>
    @@include("./partials/title-meta.html", {"title": "Visualizar"})

    @@include('./partials/head-css.html')
</head>

<body>
    <!-- Begin page -->
    <div class="wrapper">

        @@include('./partials/menu.html')

        <!-- ============================================================== -->
        <!-- Start Main Content -->
        <!-- ============================================================== -->

        <div class="content-page">
            <div class="container-fluid p-0 min-vh-100">

                @@include("./partials/page-title.html", {"subtitle": "Portal de projetos", "title":"Visualizar projeto"})

                <div class="row g-0 min-vh-100 w-100">
                    <div class="col-xxl-12">

                        <!-- Project Main Details -->
                        <div class="col-xxl-12">
                            <div class="card card-h-100 rounded-0 rounded-start">
                                <div class="card-header align-items-start p-4">
                                    <div>
                                        <h3 class="mb-1 d-flex fs-xl align-items-center">0006 - Integração de Sistemas de Pagamento</h3>
                                        <span class="badge badge-soft-success fs-xxs badge-label">Em execução</span>
                                        <span class="badge badge-soft-success fs-xxs badge-label">Em andamento</span>
                                    </div>

                                    <!-- Quick Actions -->
                                    <div class="ms-auto">
                                        <a class="btn btn-primary dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                                           data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            Ações
                                        </a>
                                        <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                            <a class="dropdown-item" href="#">Editar</a>
                                            <a class="dropdown-item" href="#">Favoritar</a>
                                            <a class="dropdown-item" href="#">Compartilhar</a>
                                            <a class="dropdown-item" href="#">EvA Chat</a>
                                            <a class="dropdown-item disabled" href="#" tabindex="-1" aria-disabled="true">Iniciar planejamento</a>
                                            <a class="dropdown-item disabled" href="#" tabindex="-1" aria-disabled="true">Gerar TAP</a>
                                        </div>
                                    </div>
                                </div>

                                <div class="card-body px-4">
                                    <!-- Tabs -->
                                    <ul class="nav nav-tabs nav-bordered mb-3" role="tablist">
                                        <li class="nav-item">
                                            <a class="nav-link active" data-bs-toggle="tab" href="#tab-overview" role="tab">
                                                <span class="d-none d-md-inline-block align-middle">Visão geral</span>
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" data-bs-toggle="tab" href="#tab-schedule" role="tab">
                                                <span class="d-none d-md-inline-block align-middle">Cronograma</span>
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" data-bs-toggle="tab" href="#tab-monitoring" role="tab">
                                                <span class="d-none d-md-inline-block align-middle">Monitoramento</span>
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" data-bs-toggle="tab" href="#tab-governance" role="tab">
                                                <span class="d-none d-md-inline-block align-middle">Governança</span>
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" data-bs-toggle="tab" href="#tab-funding" role="tab">
                                                <span class="d-none d-md-inline-block align-middle">Captação de recursos</span>
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" data-bs-toggle="tab" href="#tab-risks" role="tab">
                                                <span class="d-none d-md-inline-block align-middle">Riscos</span>
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" data-bs-toggle="tab" href="#tab-files" role="tab">
                                                <span class="d-none d-md-inline-block align-middle">Arquivos</span>
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" data-bs-toggle="tab" href="#tab-logbook" role="tab">
                                                <span class="d-none d-md-inline-block align-middle">Diário de bordo</span>
                                            </a>
                                        </li>
                                    </ul>

                                    <div class="tab-content">

                                        <!-- ========================= -->
                                        <!-- TAB: VISÃO GERAL (EXISTENTE) -->
                                        <!-- ========================= -->
                                        <div class="tab-pane fade show active" id="tab-overview" role="tabpanel">
                                            <div class="row">
                                                <!-- Card 1 -->
                                                <div class="col px-0">
                                                    <div class="p-3 rounded m-1 border border-dashed">
                                                        <div class="d-flex align-items-center gap-2">
                                                            <div class="avatar-xl">
                                                                <span class="avatar-title rounded-circle" style="background-color: #EEF2F7;">
                                                                    <i class="ti ti-file-text fs-2" style="color: #313A46;"></i>
                                                                </span>
                                                            </div>
                                                            <div>
                                                                <h4 class="mb-1"><span>Situação do cronograma</span></h4>
                                                                <span class="badge badge-label text-bg-light" style="border-radius: 4px;">Em construção</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Card 2 -->
                                                <div class="col px-0">
                                                    <div class="p-3 rounded m-1 border border-dashed">
                                                        <div class="d-flex align-items-center gap-2">
                                                            <div class="avatar-xl">
                                                                <span class="avatar-title rounded-circle" style="background-color: #DDEDF6;">
                                                                    <i class="ti ti-calendar fs-2" style="color: #1C84C6;"></i>
                                                                </span>
                                                            </div>
                                                            <div>
                                                                <h4 class="mb-1"><span>Data de início</span></h4>
                                                                <p class="mb-0 text-muted">04/08/2024</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Card 3 -->
                                                <div class="col px-0">
                                                    <div class="p-3 rounded m-1 border border-dashed">
                                                        <div class="d-flex align-items-center gap-2">
                                                            <div class="avatar-xl">
                                                                <span class="avatar-title rounded-circle" style="background-color: #DDEDF6;">
                                                                    <i class="ti ti-flag fs-2" style="color: #1C84C6;"></i>
                                                                </span>
                                                            </div>
                                                            <div>
                                                                <h4 class="mb-1"><span>Previsão de conclusão</span></h4>
                                                                <p class="mb-0 text-muted">04/08/2025</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Card 4 -->
                                                <div class="col px-0">
                                                    <div class="p-3 rounded m-1 border border-dashed">
                                                        <div class="d-flex align-items-center gap-2">
                                                            <div class="avatar-xl">
                                                                <span class="avatar-title rounded-circle" style="background-color: #DDEDF6;">
                                                                    <i class="ti ti-clock fs-2" style="color: #1C84C6;"></i>
                                                                </span>
                                                            </div>
                                                            <div>
                                                                <h4 class="mb-1"><span>Dias restantes</span></h4>
                                                                <p class="mb-0 text-muted">144 dias</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Card 5 -->
                                                <div class="col px-0">
                                                    <div class="p-3 rounded m-1 border border-dashed">
                                                        <div class="d-flex align-items-center gap-2">
                                                            <div class="avatar-xl">
                                                                <span class="avatar-title rounded-circle" style="background-color: #DDEDF6;">
                                                                    <i class="ti ti-chart-bar fs-2" style="color: #1C84C6;"></i>
                                                                </span>
                                                            </div>
                                                            <div class="flex-grow-1">
                                                                <h4 class="mb-1"><span>Progresso físico</span></h4>
                                                                <div class="d-flex align-items-center gap-2">
                                                                    <p class="text-muted mb-0"><span>50%</span></p>
                                                                    <div class="progress bg-primary bg-opacity-25 progress-sm flex-grow-1 mb-0">
                                                                        <div class="progress-bar bg-primary" role="progressbar" style="width: 50%"
                                                                             aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div><!-- end row -->
                                        </div>
                                        <!-- ========================= -->
                                        <!-- TAB: CRONOGRAMA (NOVO) -->
                                        <!-- ========================= -->
                                        <div class="tab-pane fade" id="tab-schedule" role="tabpanel">
                                            <!-- Header: título + ações -->
                                            <div class="d-flex flex-wrap gap-2 align-items-center justify-content-between mb-3">
                                                <div>
                                                    <h4 class="mb-0">Cronograma</h4>
                                                    <p class="text-muted mb-0">
                                                        Execução física do projeto (marcos, atividades, prazos e progresso).
                                                    </p>
                                                </div>

                                                <div class="d-flex gap-2">
                                                    <button class="btn btn-light" type="button" data-bs-toggle="modal" data-bs-target="#modalExportarCronograma">
                                                        <i class="ti ti-download me-1"></i>Exportar
                                                    </button>

                                                    <button class="btn btn-primary" type="button" data-bs-toggle="modal" data-bs-target="#modalReplanejarCronograma">
                                                        <i class="ti ti-calendar-time me-1"></i>Replanejar
                                                    </button>
                                                </div>
                                            </div>

                                            <!-- Filtros -->
                                            <div class="card border mb-3">
                                                <div class="card-body">
                                                    <div class="row g-2 align-items-end">
                                                        <div class="col-12 col-lg-5">
                                                            <label class="form-label mb-1">Buscar</label>
                                                            <div class="input-group">
                                                                <span class="input-group-text"><i class="ti ti-search"></i></span>
                                                                <input type="text" class="form-control" id="scheduleSearch"
                                                                       placeholder="Buscar por marco, atividade ou responsável...">
                                                            </div>
                                                        </div>

                                                        <div class="col-12 col-md-6 col-lg-3">
                                                            <label class="form-label mb-1">Status</label>
                                                            <select class="form-select" id="scheduleStatus">
                                                                <option value="">Todos</option>
                                                                <option value="future">Futuras</option>
                                                                <option value="ongoing">Em andamento</option>
                                                                <option value="done">Concluídas</option>
                                                                <option value="late">Atrasadas</option>
                                                            </select>
                                                        </div>

                                                        <div class="col-12 col-md-6 col-lg-2">
                                                            <label class="form-label mb-1">Período</label>
                                                            <select class="form-select" id="scheduleRange">
                                                                <option value="all">Tudo</option>
                                                                <option value="30">Próximos 30 dias</option>
                                                                <option value="90">Próximos 90 dias</option>
                                                            </select>
                                                        </div>

                                                        <div class="col-12 col-lg-2">
                                                            <div class="d-flex gap-2">
                                                                <button class="btn btn-light w-100" type="button" id="scheduleClear">
                                                                    <i class="ti ti-eraser me-1"></i>Limpar
                                                                </button>
                                                                <button class="btn btn-primary w-100" type="button" id="scheduleApply">
                                                                    <i class="ti ti-filter me-1"></i>Filtrar
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="mt-2 text-muted fs-12">
                                                        Observação: parte dos indicadores pode estar "em branco" no protótipo (conforme requisitos).
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row g-3">
                                                <!-- Left: Timeline + Tabela -->
                                                <div class="col-12">
                                                    <!-- Timeline (visual simples) - Nova proposta: Vertical Timeline -->
                                                    <div class="card border mb-3">
                                                        <div class="card-body">
                                                            <div class="d-flex align-items-center justify-content-between mb-2">
                                                                <div class="fw-semibold">Linha do tempo (visual)</div>
                                                                <div class="text-muted fs-12">Visual vertical simplificado (o dado oficial está na tabela)</div>
                                                            </div>

                                                            <div class="vertical-timeline">
                                                                <div class="timeline-item">
                                                                    <div class="timeline-marker done"></div>
                                                                    <div class="timeline-content">
                                                                        <div class="fw-semibold">Marco 1: Iniciação</div>
                                                                        <div class="text-muted fs-12">04/08/2024 → 10/08/2024</div>
                                                                        <div class="progress mt-1" style="height: 6px;">
                                                                            <div class="progress-bar bg-success" style="width: 100%"></div>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <div class="timeline-item">
                                                                    <div class="timeline-marker ongoing"></div>
                                                                    <div class="timeline-content">
                                                                        <div class="fw-semibold">Marco 2: Planejamento</div>
                                                                        <div class="text-muted fs-12">11/08/2024 → 25/08/2024</div>
                                                                        <div class="progress mt-1" style="height: 6px;">
                                                                            <div class="progress-bar bg-warning" style="width: 80%"></div>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <div class="timeline-item">
                                                                    <div class="timeline-marker ongoing"></div>
                                                                    <div class="timeline-content">
                                                                        <div class="fw-semibold">Marco 3: Desenvolvimento</div>
                                                                        <div class="text-muted fs-12">26/08/2024 → 15/10/2024</div>
                                                                        <div class="progress mt-1" style="height: 6px;">
                                                                            <div class="progress-bar bg-info" style="width: 60%"></div>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <div class="timeline-item">
                                                                    <div class="timeline-marker future"></div>
                                                                    <div class="timeline-content">
                                                                        <div class="fw-semibold">Marco 4: Testes</div>
                                                                        <div class="text-muted fs-12">16/10/2024 → 30/11/2024</div>
                                                                        <div class="progress mt-1" style="height: 6px;">
                                                                            <div class="progress-bar bg-secondary" style="width: 30%"></div>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <div class="timeline-item">
                                                                    <div class="timeline-marker future"></div>
                                                                    <div class="timeline-content">
                                                                        <div class="fw-semibold">Marco 5: Implantação</div>
                                                                        <div class="text-muted fs-12">01/12/2024 → 15/01/2025</div>
                                                                        <div class="progress mt-1" style="height: 6px;">
                                                                            <div class="progress-bar bg-secondary" style="width: 0%"></div>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <div class="timeline-item">
                                                                    <div class="timeline-marker future"></div>
                                                                    <div class="timeline-content">
                                                                        <div class="fw-semibold">Marco 6: Finalização</div>
                                                                        <div class="text-muted fs-12">16/01/2025 → 04/08/2025</div>
                                                                        <div class="progress mt-1" style="height: 6px;">
                                                                            <div class="progress-bar bg-secondary" style="width: 0%"></div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Tabela do cronograma -->
                                                    <div class="card border mb-0">
                                                        <div class="card-body">
                                                            <div class="d-flex align-items-center justify-content-between mb-2">
                                                                <div class="fw-semibold">Execução física (grid)</div>

                                                                <div class="d-flex gap-2">
                                                                    <button class="btn btn-light btn-sm" type="button">
                                                                        <i class="ti ti-upload me-1"></i>Importar CSV
                                                                    </button>
                                                                    <button class="btn btn-primary btn-sm" type="button" data-bs-toggle="modal" data-bs-target="#modalAdicionarLinha">
                                                                        <i class="ti ti-plus me-1"></i>Adicionar linha
                                                                    </button>
                                                                </div>
                                                            </div>

                                                            <div class="table-responsive">
                                                                <table class="table table-custom table-centered table-hover w-100 mb-0">
                                                                    <thead class="bg-light align-middle bg-opacity-25 thead-sm">
                                                                        <tr class="text-uppercase fs-xxs">
                                                                            <th>Marco (etapa)</th>
                                                                            <th>Atividade (tarefa)</th>
                                                                            <th>Responsável</th>
                                                                            <th class="text-end">Duração</th>
                                                                            <th>Prev. início</th>
                                                                            <th>Prev. fim</th>
                                                                            <th>Início realizado</th>
                                                                            <th>Fim realizado</th>
                                                                            <th class="text-end">% Executado</th>
                                                                            <th class="text-center" style="width: 1%;">Ações</th>
                                                                        </tr>
                                                                    </thead>

                                                                    <tbody id="scheduleTableBody">
                                                                        <tr class="schedule-item" data-status="done" data-text="Iniciação Kickoff do projeto Equipe Projeto">
                                                                            <td>Iniciação</td>
                                                                            <td>Kickoff do projeto</td>
                                                                            <td>Equipe Projeto</td>
                                                                            <td class="text-end">5</td>
                                                                            <td>04/08/2024</td>
                                                                            <td>10/08/2024</td>
                                                                            <td>04/08/2024</td>
                                                                            <td>10/08/2024</td>
                                                                            <td class="text-end">100</td>
                                                                            <td class="text-center">
                                                                                <div class="d-flex justify-content-center gap-1">
                                                                                    <a href="#" class="btn btn-light btn-icon btn-sm rounded-circle edit-btn" data-bs-toggle="modal" data-bs-target="#modalEditarLinha" data-row='{"marco":"Iniciação","atividade":"Kickoff do projeto","responsavel":"Equipe Projeto","duracao":"5","prevInicio":"04/08/2024","prevFim":"10/08/2024","inicioReal":"04/08/2024","fimReal":"10/08/2024","percent":"100"}'>
                                                                                        <i class="ti ti-pencil fs-lg"></i>
                                                                                    </a>
                                                                                    <a href="#" class="btn btn-light btn-icon btn-sm rounded-circle delete-btn" data-bs-toggle="modal" data-bs-target="#modalConfirmarExclusao">
                                                                                        <i class="ti ti-trash fs-lg"></i>
                                                                                    </a>
                                                                                </div>
                                                                            </td>
                                                                        </tr>

                                                                        <tr class="schedule-item" data-status="ongoing" data-text="Planejamento Definir requisitos Time Dev">
                                                                            <td>Planejamento</td>
                                                                            <td>Definir requisitos</td>
                                                                            <td>Time Dev</td>
                                                                            <td class="text-end">10</td>
                                                                            <td>11/08/2024</td>
                                                                            <td>25/08/2024</td>
                                                                            <td>11/08/2024</td>
                                                                            <td>—</td>
                                                                            <td class="text-end">80</td>
                                                                            <td class="text-center">
                                                                                <div class="d-flex justify-content-center gap-1">
                                                                                    <a href="#" class="btn btn-light btn-icon btn-sm rounded-circle edit-btn" data-bs-toggle="modal" data-bs-target="#modalEditarLinha" data-row='{"marco":"Planejamento","atividade":"Definir requisitos","responsavel":"Time Dev","duracao":"10","prevInicio":"11/08/2024","prevFim":"25/08/2024","inicioReal":"11/08/2024","fimReal":"","percent":"80"}'>
                                                                                        <i class="ti ti-pencil fs-lg"></i>
                                                                                    </a>
                                                                                    <a href="#" class="btn btn-light btn-icon btn-sm rounded-circle delete-btn" data-bs-toggle="modal" data-bs-target="#modalConfirmarExclusao">
                                                                                        <i class="ti ti-trash fs-lg"></i>
                                                                                    </a>
                                                                                </div>
                                                                            </td>
                                                                        </tr>

                                                                        <tr class="schedule-item" data-status="ongoing" data-text="Desenvolvimento Implementar API Time Dev">
                                                                            <td>Desenvolvimento</td>
                                                                            <td>Implementar API</td>
                                                                            <td>Time Dev</td>
                                                                            <td class="text-end">30</td>
                                                                            <td>26/08/2024</td>
                                                                            <td>15/10/2024</td>
                                                                            <td>26/08/2024</td>
                                                                            <td>—</td>
                                                                            <td class="text-end">60</td>
                                                                            <td class="text-center">
                                                                                <div class="d-flex justify-content-center gap-1">
                                                                                    <a href="#" class="btn btn-light btn-icon btn-sm rounded-circle edit-btn" data-bs-toggle="modal" data-bs-target="#modalEditarLinha" data-row='{"marco":"Desenvolvimento","atividade":"Implementar API","responsavel":"Time Dev","duracao":"30","prevInicio":"26/08/2024","prevFim":"15/10/2024","inicioReal":"26/08/2024","fimReal":"","percent":"60"}'>
                                                                                        <i class="ti ti-pencil fs-lg"></i>
                                                                                    </a>
                                                                                    <a href="#" class="btn btn-light btn-icon btn-sm rounded-circle delete-btn" data-bs-toggle="modal" data-bs-target="#modalConfirmarExclusao">
                                                                                        <i class="ti ti-trash fs-lg"></i>
                                                                                    </a>
                                                                                </div>
                                                                            </td>
                                                                        </tr>

                                                                        <tr class="schedule-item" data-status="future" data-text="Testes Executar testes QA QA Team">
                                                                            <td>Testes</td>
                                                                            <td>Executar testes</td>
                                                                            <td>QA Team</td>
                                                                            <td class="text-end">25</td>
                                                                            <td>16/10/2024</td>
                                                                            <td>30/11/2024</td>
                                                                            <td>—</td>
                                                                            <td>—</td>
                                                                            <td class="text-end">0</td>
                                                                            <td class="text-center">
                                                                                <div class="d-flex justify-content-center gap-1">
                                                                                    <a href="#" class="btn btn-light btn-icon btn-sm rounded-circle edit-btn" data-bs-toggle="modal" data-bs-target="#modalEditarLinha" data-row='{"marco":"Testes","atividade":"Executar testes","responsavel":"QA Team","duracao":"25","prevInicio":"16/10/2024","prevFim":"30/11/2024","inicioReal":"","fimReal":"","percent":"0"}'>
                                                                                        <i class="ti ti-pencil fs-lg"></i>
                                                                                    </a>
                                                                                    <a href="#" class="btn btn-light btn-icon btn-sm rounded-circle delete-btn" data-bs-toggle="modal" data-bs-target="#modalConfirmarExclusao">
                                                                                        <i class="ti ti-trash fs-lg"></i>
                                                                                    </a>
                                                                                </div>
                                                                            </td>
                                                                        </tr>

                                                                        <tr class="schedule-item" data-status="future" data-text="Implantação Deploy em produção Ops Team">
                                                                            <td>Implantação</td>
                                                                            <td>Deploy em produção</td>
                                                                            <td>Ops Team</td>
                                                                            <td class="text-end">10</td>
                                                                            <td>01/12/2024</td>
                                                                            <td>15/01/2025</td>
                                                                            <td>—</td>
                                                                            <td>—</td>
                                                                            <td class="text-end">0</td>
                                                                            <td class="text-center">
                                                                                <div class="d-flex justify-content-center gap-1">
                                                                                    <a href="#" class="btn btn-light btn-icon btn-sm rounded-circle edit-btn" data-bs-toggle="modal" data-bs-target="#modalEditarLinha" data-row='{"marco":"Implantação","atividade":"Deploy em produção","responsavel":"Ops Team","duracao":"10","prevInicio":"01/12/2024","prevFim":"15/01/2025","inicioReal":"","fimReal":"","percent":"0"}'>
                                                                                        <i class="ti ti-pencil fs-lg"></i>
                                                                                    </a>
                                                                                    <a href="#" class="btn btn-light btn-icon btn-sm rounded-circle delete-btn" data-bs-toggle="modal" data-bs-target="#modalConfirmarExclusao">
                                                                                        <i class="ti ti-trash fs-lg"></i>
                                                                                    </a>
                                                                                </div>
                                                                            </td>
                                                                        </tr>

                                                                        <tr class="schedule-item" data-status="future" data-text="Finalização Treinamento usuários Suporte">
                                                                            <td>Finalização</td>
                                                                            <td>Treinamento usuários</td>
                                                                            <td>Suporte</td>
                                                                            <td class="text-end">15</td>
                                                                            <td>16/01/2025</td>
                                                                            <td>04/08/2025</td>
                                                                            <td>—</td>
                                                                            <td>—</td>
                                                                            <td class="text-end">0</td>
                                                                            <td class="text-center">
                                                                                <div class="d-flex justify-content-center gap-1">
                                                                                    <a href="#" class="btn btn-light btn-icon btn-sm rounded-circle edit-btn" data-bs-toggle="modal" data-bs-target="#modalEditarLinha" data-row='{"marco":"Finalização","atividade":"Treinamento usuários","responsavel":"Suporte","duracao":"15","prevInicio":"16/01/2025","prevFim":"04/08/2025","inicioReal":"","fimReal":"","percent":"0"}'>
                                                                                        <i class="ti ti-pencil fs-lg"></i>
                                                                                    </a>
                                                                                    <a href="#" class="btn btn-light btn-icon btn-sm rounded-circle delete-btn" data-bs-toggle="modal" data-bs-target="#modalConfirmarExclusao">
                                                                                        <i class="ti ti-trash fs-lg"></i>
                                                                                    </a>
                                                                                </div>
                                                                            </td>
                                                                        </tr>

                                                                        <!-- Estado vazio (quando não houver linhas) -->
                                                                        <tr class="empty-state">
                                                                            <td colspan="10" class="text-center text-muted py-4">
                                                                                O cronograma ainda não foi definido para este projeto.
                                                                            </td>
                                                                        </tr>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- ========================= -->
                                        <!-- TAB: MONITORAMENTO -->
                                        <!-- ========================= -->
                                        <div class="tab-pane fade" id="tab-monitoring" role="tabpanel">
                                            <div class="alert alert-light border mb-0">
                                                <i class="ti ti-info-circle me-1"></i>
                                                Conteúdo do Monitoramento (placeholder).
                                            </div>
                                        </div>

                                        <!-- ========================= -->
                                        <!-- TAB: GOVERNANÇA -->
                                        <!-- ========================= -->
                                        <div class="tab-pane fade" id="tab-governance" role="tabpanel">
                                            <div class="alert alert-light border mb-0">
                                                <i class="ti ti-info-circle me-1"></i>
                                                Conteúdo de Governança (placeholder).
                                            </div>
                                        </div>

                                        <!-- ========================= -->
                                        <!-- TAB: CAPTAÇÃO -->
                                        <!-- ========================= -->
                                        <div class="tab-pane fade" id="tab-funding" role="tabpanel">
                                            <div class="alert alert-light border mb-0">
                                                <i class="ti ti-info-circle me-1"></i>
                                                Conteúdo de Captação de recursos (placeholder).
                                            </div>
                                        </div>

                                        <!-- ========================= -->
                                        <!-- TAB: RISCOS -->
                                        <!-- ========================= -->
                                        <div class="tab-pane fade" id="tab-risks" role="tabpanel">
                                            <div class="alert alert-light border mb-0">
                                                <i class="ti ti-info-circle me-1"></i>
                                                Conteúdo de Riscos (placeholder).
                                            </div>
                                        </div>

                                        <!-- ========================= -->
                                        <!-- TAB: ARQUIVOS -->
                                        <!-- ========================= -->
                                        <div class="tab-pane fade" id="tab-files" role="tabpanel">
                                            <div class="alert alert-light border mb-0">
                                                <i class="ti ti-info-circle me-1"></i>
                                                Conteúdo de Arquivos (placeholder).
                                            </div>
                                        </div>

                                        <!-- ========================= -->
                                        <!-- TAB: DIÁRIO DE BORDO (NOVO) -->
                                        <!-- ========================= -->
                                        <div class="tab-pane fade" id="tab-logbook" role="tabpanel">

                                            <!-- Header: resumo rápido + ações -->
                                            <div class="d-flex flex-wrap gap-2 align-items-center justify-content-between mb-3">
                                                <div>
                                                    <h4 class="mb-0">Diário de bordo</h4>
                                                    <p class="text-muted mb-0">Histórico do projeto em formato de timeline, com registros rastreáveis de decisões, marcos, riscos e atualizações.</p>
                                                </div>

                                                <div class="d-flex gap-2">
                                                    <button class="btn btn-light" type="button">
                                                        <i class="ti ti-download me-1"></i>Exportar
                                                    </button>
                                                    <button class="btn btn-primary" type="button" data-bs-toggle="modal" data-bs-target="#modalNewLogEntry">
                                                        <i class="ti ti-plus me-1"></i>Nova entrada
                                                    </button>
                                                </div>
                                            </div>

                                            <!-- Cards de resumo -->
                                            <div class="row g-2 mb-3">
                                                <div class="col-12 col-md-6 col-xl-3">
                                                    <div class="card border mb-0">
                                                        <div class="card-body">
                                                            <div class="d-flex align-items-center">
                                                                <div class="avatar-sm me-2">
                                                                    <span class="avatar-title rounded-circle bg-light text-dark">
                                                                        <i class="ti ti-history"></i>
                                                                    </span>
                                                                </div>
                                                                <div class="flex-grow-1">
                                                                    <div class="text-muted fs-12">Última atualização</div>
                                                                    <div class="fw-semibold">28/08/2025 13:00</div>
                                                                    <div class="text-muted fs-12">Sammys Cezar • Diretoria</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-12 col-md-6 col-xl-3">
                                                    <div class="card border mb-0">
                                                        <div class="card-body">
                                                            <div class="d-flex align-items-center">
                                                                <div class="avatar-sm me-2">
                                                                    <span class="avatar-title rounded-circle bg-light text-dark">
                                                                        <i class="ti ti-flag"></i>
                                                                    </span>
                                                                </div>
                                                                <div class="flex-grow-1">
                                                                    <div class="text-muted fs-12">Último marco</div>
                                                                    <div class="fw-semibold">Kickoff realizado</div>
                                                                    <div class="text-muted fs-12">25/08/2025 • Registro automático</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-12 col-md-6 col-xl-3">
                                                    <div class="card border mb-0">
                                                        <div class="card-body">
                                                            <div class="d-flex align-items-center">
                                                                <div class="avatar-sm me-2">
                                                                    <span class="avatar-title rounded-circle bg-light text-dark">
                                                                        <i class="ti ti-alert-triangle"></i>
                                                                    </span>
                                                                </div>
                                                                <div class="flex-grow-1">
                                                                    <div class="text-muted fs-12">Pendências críticas</div>
                                                                    <div class="fw-semibold">2 riscos abertos</div>
                                                                    <div class="text-muted fs-12">1 impedimento ativo</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-12 col-md-6 col-xl-3">
                                                    <div class="card border mb-0">
                                                        <div class="card-body">
                                                            <div class="d-flex align-items-center">
                                                                <div class="avatar-sm me-2">
                                                                    <span class="avatar-title rounded-circle bg-light text-dark">
                                                                        <i class="ti ti-steps"></i>
                                                                    </span>
                                                                </div>
                                                                <div class="flex-grow-1">
                                                                    <div class="text-muted fs-12">Próximo passo</div>
                                                                    <div class="fw-semibold">Contratação (etapa)</div>
                                                                    <div class="text-muted fs-12">Previsão: 02/09/2025</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Filtros -->
                                            <div class="card border mb-3">
                                                <div class="card-body">
                                                    <div class="row g-2 align-items-end">
                                                        <div class="col-12 col-lg-4">
                                                            <label class="form-label mb-1">Buscar</label>
                                                            <div class="input-group">
                                                                <span class="input-group-text"><i class="ti ti-search"></i></span>
                                                                <input type="text" class="form-control" placeholder="Buscar por palavra-chave, decisão, marco, risco..." id="logSearchInput">
                                                            </div>
                                                        </div>

                                                        <div class="col-12 col-md-6 col-lg-2">
                                                            <label class="form-label mb-1">Tipo</label>
                                                            <select class="form-select" id="logTypeFilter">
                                                                <option value="">Todos</option>
                                                                <option value="status">Atualização de status</option>
                                                                <option value="milestone">Marco/entrega</option>
                                                                <option value="decision">Decisão</option>
                                                                <option value="risk">Risco/impedimento</option>
                                                                <option value="scope">Mudança de escopo</option>
                                                                <option value="meeting">Reunião/comunicação</option>
                                                                <option value="approval">Aprovação/validação</option>
                                                                <option value="file">Documento/arquivo</option>
                                                                <option value="note">Observação</option>
                                                            </select>
                                                        </div>

                                                        <div class="col-12 col-md-6 col-lg-2">
                                                            <label class="form-label mb-1">Autor</label>
                                                            <select class="form-select" id="logAuthorFilter">
                                                                <option value="">Todos</option>
                                                                <option value="sammys">Sammys Cezar</option>
                                                                <option value="maria">Maria Silva</option>
                                                                <option value="joao">João Santos</option>
                                                                <option value="leonardo">Leonardo Queiroz</option>
                                                                <option value="sistema">Sistema GoMAP</option>
                                                            </select>
                                                        </div>

                                                        <div class="col-12 col-md-6 col-lg-2">
                                                            <label class="form-label mb-1">Período</label>
                                                            <select class="form-select" id="logRangeFilter">
                                                                <option value="30">Últimos 30 dias</option>
                                                                <oringg</option>
                                                                <option value="7">Últimos 7 dias</option>
                                                                <option value="90">Últimos 90 dias</option>
                                                                <option value="all">Tudo</option>
                                                            </select>
                                                        </div>

                                                        <div class="col-12 col-md-6 col-lg-2">
                                                            <div class="d-flex gap-2">
                                                                <button class="btn btn-light w-100" type="button" id="logClearFilters">
                                                                    <i class="ti ti-eraser me-1"></i>Limpar
                                                                </button>
                                                                <button class="btn btn-primary w-100" type="button" id="logApplyFilters">
                                                                    <i class="ti ti-filter me-1"></i>Filtrar
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="mt-2 text-muted fs-12">
                                                        Dica: use “Tipo” para encontrar rapidamente decisões, mudanças de escopo e riscos.
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Timeline -->
                                            <div class="card border mb-0">
                                                <div class="card-body">

                                                    <div class="d-flex align-items-center justify-content-between mb-2">
                                                        <div class="fw-semibold">Timeline</div>
                                                        <div class="dropdown">
                                                            <button class="btn btn-light btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                                Mais recentes
                                                            </button>
                                                            <ul class="dropdown-menu dropdown-menu-end">
                                                                <li><a class="dropdown-item" href="#">Mais recentes</a></li>
                                                                <li><a class="dropdown-item" href="#">Mais antigas</a></li>
                                                                <li><a class="dropdown-item" href="#">Somente fixadas</a></li>
                                                            </ul>
                                                        </div>
                                                    </div>

                                                    <!-- item -->
                                                    <div class="border rounded p-3 mb-2 log-item"
                                                         data-type="decision" data-author="sammys" data-text="Estudo preliminar aprovado diretoria contratação empresa projetos">
                                                        <div class="d-flex align-items-start gap-3">
                                                            <div class="avatar-sm flex-shrink-0">
                                                                <span class="avatar-title rounded-circle bg-light text-dark">
                                                                    <i class="ti ti-gavel"></i>
                                                                </span>
                                                            </div>

                                                            <div class="flex-grow-1">
                                                                <div class="d-flex flex-wrap gap-2 align-items-center">
                                                                    <span class="badge badge-label text-bg-light">DECISÃO</span>
                                                                    <div class="fw-semibold">Estudo preliminar aprovado pela diretoria</div>
                                                                    <div class="text-muted ms-auto fs-12">28/08/2025 13:00</div>
                                                                </div>

                                                                <div class="text-muted fs-12 mt-1">
                                                                    Sammys Cezar • Diretoria
                                                                    <span class="mx-2">•</span>
                                                                    Impacto: <span class="badge badge-soft-warning fs-xxs">Médio</span>
                                                                    <span class="mx-2">•</span>
                                                                    Relacionado: <span class="badge badge-soft-primary fs-xxs">#Contratação</span>
                                                                </div>

                                                                <p class="mb-2 mt-2">
                                                                    O estudo preliminar do novo SEDI foi aprovado pela diretoria. Próxima etapa: contratação da empresa de projetos.
                                                                </p>

                                                                <div class="d-flex flex-wrap gap-2">
                                                                    <a href="#" class="btn btn-light btn-sm"><i class="ti ti-paperclip me-1"></i>Anexos (1)</a>
                                                                    <a href="#" class="btn btn-light btn-sm"><i class="ti ti-eye me-1"></i>Ver mais</a>
                                                                    <a href="#" class="btn btn-light btn-sm"><i class="ti ti-pin me-1"></i>Fixar</a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- item -->
                                                    <div class="border rounded p-3 mb-2 log-item"
                                                         data-type="meeting" data-author="maria" data-text="Discussão requisitos funcionais prédio ambientes capacidade">
                                                        <div class="d-flex align-items-start gap-3">
                                                            <div class="avatar-sm flex-shrink-0">
                                                                <span class="avatar-title rounded-circle bg-light text-dark">
                                                                    <i class="ti ti-users"></i>
                                                                </span>
                                                            </div>

                                                            <div class="flex-grow-1">
                                                                <div class="d-flex flex-wrap gap-2 align-items-center">
                                                                    <span class="badge badge-label text-bg-light">REUNIÃO</span>
                                                                    <div class="fw-semibold">Requisitos funcionais do prédio definidos</div>
                                                                    <div class="text-muted ms-auto fs-12">26/08/2025 15:14</div>
                                                                </div>

                                                                <div class="text-muted fs-12 mt-1">
                                                                    Maria Silva • Planejamento
                                                                    <span class="mx-2">•</span>
                                                                    Relacionado: <span class="badge badge-soft-primary fs-xxs">#Escopo</span>
                                                                </div>

                                                                <p class="mb-2 mt-2">
                                                                    Discussão sobre requisitos funcionais do prédio. Definidos os principais ambientes e capacidade.
                                                                </p>

                                                                <div class="d-flex flex-wrap gap-2">
                                                                    <a href="#" class="btn btn-light btn-sm"><i class="ti ti-paperclip me-1"></i>Anexos (0)</a>
                                                                    <a href="#" class="btn btn-light btn-sm"><i class="ti ti-eye me-1"></i>Ver mais</a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- item -->
                                                    <div class="border rounded p-3 mb-2 log-item"
                                                         data-type="file" data-author="joao" data-text="Relatório técnico topográfico geotécnico terreno anexo">
                                                        <div class="d-flex align-items-start gap-3">
                                                            <div class="avatar-sm flex-shrink-0">
                                                                <span class="avatar-title rounded-circle bg-light text-dark">
                                                                    <i class="ti ti-file-description"></i>
                                                                </span>
                                                            </div>

                                                            <div class="flex-grow-1">
                                                                <div class="d-flex flex-wrap gap-2 align-items-center">
                                                                    <span class="badge badge-label text-bg-light">DOCUMENTO</span>
                                                                    <div class="fw-semibold">Relatório técnico anexado</div>
                                                                    <div class="text-muted ms-auto fs-12">27/08/2025 09:30</div>
                                                                </div>

                                                                <div class="text-muted fs-12 mt-1">
                                                                    João Santos • Engenharia
                                                                    <span class="mx-2">•</span>
                                                                    Relacionado: <span class="badge badge-soft-primary fs-xxs">#Terreno</span>
                                                                </div>

                                                                <p class="mb-2 mt-2">
                                                                    Finalizada a análise topográfica e geotécnica do terreno. Relatório técnico em anexo.
                                                                </p>

                                                                <div class="d-flex flex-wrap gap-2">
                                                                    <a href="#" class="btn btn-light btn-sm"><i class="ti ti-paperclip me-1"></i>Anexos (1)</a>
                                                                    <a href="#" class="btn btn-light btn-sm"><i class="ti ti-download me-1"></i>Baixar relatório</a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- item -->
                                                    <div class="border rounded p-3 mb-2 log-item"
                                                         data-type="milestone" data-author="leonardo" data-text="Kickoff realizado cronograma inicial responsabilidades equipe">
                                                        <div class="d-flex align-items-start gap-3">
                                                            <div class="avatar-sm flex-shrink-0">
                                                                <span class="avatar-title rounded-circle bg-light text-dark">
                                                                    <i class="ti ti-flag"></i>
                                                                </span>
                                                            </div>

                                                            <div class="flex-grow-1">
                                                                <div class="d-flex flex-wrap gap-2 align-items-center">
                                                                    <span class="badge badge-label text-bg-light">MARCO</span>
                                                                    <div class="fw-semibold">Kickoff do projeto concluído</div>
                                                                    <div class="text-muted ms-auto fs-12">25/08/2025 11:45</div>
                                                                </div>

                                                                <div class="text-muted fs-12 mt-1">
                                                                    Leonardo Queiroz • PMO
                                                                    <span class="mx-2">•</span>
                                                                    Relacionado: <span class="badge badge-soft-primary fs-xxs">#Kickoff</span>
                                                                </div>

                                                                <p class="mb-2 mt-2">
                                                                    Reunião de kickoff realizada com sucesso. Apresentação do cronograma inicial e definição das responsabilidades da equipe.
                                                                </p>

                                                                <div class="d-flex flex-wrap gap-2">
                                                                    <a href="#" class="btn btn-light btn-sm"><i class="ti ti-paperclip me-1"></i>Anexos (1)</a>
                                                                    <a href="#" class="btn btn-light btn-sm"><i class="ti ti-eye me-1"></i>Ver ata</a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- item automático -->
                                                    <div class="border rounded p-3 mb-2 log-item"
                                                         data-type="status" data-author="sistema" data-text="Projeto iniciado equipes notificadas recursos alocados">
                                                        <div class="d-flex align-items-start gap-3">
                                                            <div class="avatar-sm flex-shrink-0">
                                                                <span class="avatar-title rounded-circle bg-light text-success">
                                                                    <i class="ti ti-robot"></i>
                                                                </span>
                                                            </div>

                                                            <div class="flex-grow-1">
                                                                <div class="d-flex flex-wrap gap-2 align-items-center">
                                                                    <span class="badge badge-soft-success fs-xxs">AUTOMÁTICO</span>
                                                                    <span class="badge badge-label text-bg-light">STATUS</span>
                                                                    <div class="fw-semibold">Projeto iniciado no sistema</div>
                                                                    <div class="text-muted ms-auto fs-12">24/08/2025 10:00</div>
                                                                </div>

                                                                <div class="text-muted fs-12 mt-1">
                                                                    Sistema GoMAP
                                                                </div>

                                                                <p class="mb-2 mt-2">
                                                                    O projeto foi oficialmente iniciado no sistema. Todas as equipes foram notificadas e os recursos foram alocados.
                                                                </p>

                                                                <div class="d-flex flex-wrap gap-2">
                                                                    <a href="#" class="btn btn-light btn-sm"><i class="ti ti-eye me-1"></i>Ver detalhes</a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="text-center mt-3">
                                                        <a href="#" class="btn btn-link">Carregar mais entradas...</a>
                                                    </div>

                                                </div>
                                            </div>

                                        </div><!-- end tab diary -->

                                    </div><!-- end tab-content -->
                                </div><!-- end card-body -->
                            </div><!-- end card -->
                        </div><!-- end col -->

                                        </div><!-- end col -->
                                        </div><!-- end row -->
                                        </div>
                                        </div>
                            </div>
    <!-- END wrapper -->

    <!-- Modals for Schedule Tab -->
    <!-- Modal: Exportar Cronograma -->
    <div class="modal fade" id="modalExportarCronograma" tabindex="-1" aria-labelledby="modalExportarCronogramaLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalExportarCronogramaLabel">Exportar Cronograma</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <p>Você estará fazendo o download do cronograma completo do projeto em formato Excel. Deseja confirmar?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Confirmar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Replanejar Cronograma -->
    <div class="modal fade" id="modalReplanejarCronograma" tabindex="-1" aria-labelledby="modalReplanejarCronogramaLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalReplanejarCronogramaLabel">Replanejar Cronograma</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <form id="formReplanejar">
                        <div class="row g-2">
                            <div class="col-12">
                                <label class="form-label">Nova data de início do projeto</label>
                                <input type="date" class="form-control" id="novaDataInicio">
                            </div>
                            <div class="col-12">
                                <label class="form-label">Nova data de conclusão prevista</label>
                                <input type="date" class="form-control" id="novaDataConclusao">
                            </div>
                            <div class="col-12">
                                <label class="form-label">Justificativa para replanejamento</label>
                                <textarea class="form-control" id="justificativaReplanejamento" rows="3" placeholder="Explique os motivos da mudança..."></textarea>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Impacto estimado</label>
                                <select class="form-select" id="impactoReplanejamento">
                                    <option value="baixo">Baixo</option>
                                    <option value="medio" selected>Médio</option>
                                    <option value="alto">Alto</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Salvar Replanejamento</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Adicionar Linha -->
    <div class="modal fade" id="modalAdicionarLinha" tabindex="-1" aria-labelledby="modalAdicionarLinhaLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalAdicionarLinhaLabel">Adicionar Nova Atividade</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <form id="formAdicionarLinha">
                        <div class="row g-2">
                            <div class="col-12 col-md-6">
                                <label class="form-label">Marco (etapa)</label>
                                <input type="text" class="form-control" id="addMarco" required>
                            </div>
                            <div class="col-12 col-md-6">
                                <label class="form-label">Atividade (tarefa)</label>
                                <input type="text" class="form-control" id="addAtividade" required>
                            </div>
                            <div class="col-12 col-md-6">
                                <label class="form-label">Responsável</label>
                                <input type="text" class="form-control" id="addResponsavel" required>
                            </div>
                            <div class="col-12 col-md-6">
                                <label class="form-label">Duração (dias)</label>
                                <input type="number" class="form-control" id="addDuracao" required>
                            </div>
                            <div class="col-12 col-md-6">
                                <label class="form-label">Prev. início</label>
                                <input type="date" class="form-control" id="addPrevInicio" required>
                            </div>
                            <div class="col-12 col-md-6">
                                <label class="form-label">Prev. fim</label>
                                <input type="date" class="form-control" id="addPrevFim" required>
                            </div>
                            <div class="col-12 col-md-6">
                                <label class="form-label">Início realizado</label>
                                <input type="date" class="form-control" id="addInicioReal">
                            </div>
                            <div class="col-12 col-md-6">
                                <label class="form-label">Fim realizado</label>
                                <input type="date" class="form-control" id="addFimReal">
                            </div>
                            <div class="col-12">
                                <label class="form-label">% Executado</label>
                                <input type="number" class="form-control" id="addPercent" min="0" max="100" value="0">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="btnSalvarAdicionar">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Editar Linha -->
    <div class="modal fade" id="modalEditarLinha" tabindex="-1" aria-labelledby="modalEditarLinhaLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalEditarLinhaLabel">Editar Atividade</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <form id="formEditarLinha">
                        <div class="row g-2">
                            <div class="col-12 col-md-6">
                                <label class="form-label">Marco (etapa)</label>
                                <input type="text" class="form-control" id="editMarco" required>
                            </div>
                            <div class="col-12 col-md-6">
                                <label class="form-label">Atividade (tarefa)</label>
                                <input type="text" class="form-control" id="editAtividade" required>
                            </div>
                            <div class="col-12 col-md-6">
                                <label class="form-label">Responsável</label>
                                <input type="text" class="form-control" id="editResponsavel" required>
                            </div>
                            <div class="col-12 col-md-6">
                                <label class="form-label">Duração (dias)</label>
                                <input type="number" class="form-control" id="editDuracao" required>
                            </div>
                            <div class="col-12 col-md-6">
                                <label class="form-label">Prev. início</label>
                                <input type="date" class="form-control" id="editPrevInicio" required>
                            </div>
                            <div class="col-12 col-md-6">
                                <label class="form-label">Prev. fim</label>
                                <input type="date" class="form-control" id="editPrevFim" required>
                            </div>
                            <div class="col-12 col-md-6">
                                <label class="form-label">Início realizado</label>
                                <input type="date" class="form-control" id="editInicioReal">
                            </div>
                            <div class="col-12 col-md-6">
                                <label class="form-label">Fim realizado</label>
                                <input type="date" class="form-control" id="editFimReal">
                            </div>
                            <div class="col-12">
                                <label class="form-label">% Executado</label>
                                <input type="number" class="form-control" id="editPercent" min="0" max="100">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="btnSalvarEditar">Salvar Alterações</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Confirmar Exclusão -->
    <div class="modal fade" id="modalConfirmarExclusao" tabindex="-1" aria-labelledby="modalConfirmarExclusaoLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalConfirmarExclusaoLabel">Confirmar Exclusão</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <p>Tem certeza de que deseja excluir esta atividade do cronograma? Esta ação não pode ser desfeita.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Excluir</button>
                </div>
            </div>
        </div>
    </div>

    <!-- @@include('./partials/customizer.html') -->

    @@include('./partials/footer-scripts.html')

    <!-- E Charts js -->
    <script src="assets/plugins/echarts/echarts.min.js"></script>

    <!-- Dashboard Page js -->
    <script src="assets/js/pages/dashboard.js"></script>

    <!-- Diário de bordo (UI-only) -->
    <script>
        (function () {
            const typeSelect = document.getElementById('newLogType');
            const sections = {
                decision: document.getElementById('sectionDecision'),
                risk: document.getElementById('sectionRisk'),
                milestone: document.getElementById('sectionMilestone'),
                scope: document.getElementById('sectionScope'),
            };

            function hideAllSections() {
                Object.values(sections).forEach(el => el && el.classList.add('d-none'));
            }

            function showSectionByType(type) {
                hideAllSections();
                if (type === 'decision') sections.decision.classList.remove('d-none');
                if (type === 'risk') sections.risk.classList.remove('d-none');
                if (type === 'milestone') sections.milestone.classList.remove('d-none');
                if (type === 'scope') sections.scope.classList.remove('d-none');
            }

            if (typeSelect) {
                typeSelect.addEventListener('change', function () {
                    showSectionByType(this.value);
                });
            }

            // Filtros (protótipo simples: filtra por texto/tipo/autor)
            const searchInput = document.getElementById('logSearchInput');
            const filterType = document.getElementById('logTypeFilter');
            const filterAuthor = document.getElementById('logAuthorFilter');
            const applyBtn = document.getElementById('logApplyFilters');
            const clearBtn = document.getElementById('logClearFilters');

            function applyFilters() {
                const q = (searchInput?.value || '').trim().toLowerCase();
                const t = filterType?.value || '';
                const a = filterAuthor?.value || '';

                document.querySelectorAll('.log-item').forEach(item => {
                    const text = (item.getAttribute('data-text') || '').toLowerCase();
                    const type = item.getAttribute('data-type') || '';
                    const author = item.getAttribute('data-author') || '';

                    const okQ = !q || text.includes(q);
                    const okT = !t || type === t;
                    const okA = !a || author === a;

                    item.classList.toggle('d-none', !(okQ && okT && okA));
                });
            }

            applyBtn?.addEventListener('click', applyFilters);

            clearBtn?.addEventListener('click', function () {
                if (searchInput) searchInput.value = '';
                if (filterType) filterType.value = '';
                if (filterAuthor) filterAuthor.value = '';
                applyFilters();
            });

            document.getElementById('btnSaveLogEntry')?.addEventListener('click', function () {
                // protótipo: só valida campos obrigatórios
                const title = document.getElementById('newLogTitle');
                const type = document.getElementById('newLogType');

                if (!type?.value || !title?.value.trim()) {
                    alert('Preencha o tipo do evento e o título.');
                    return;
                }
                alert('Entrada salva (protótipo UI). Aqui você chamaria sua API e atualizaria a timeline.');
            });

            // Schedule Tab Functionality
            const scheduleSearch = document.getElementById('scheduleSearch');
            const scheduleStatus = document.getElementById('scheduleStatus');
            const scheduleRange = document.getElementById('scheduleRange');
            const scheduleApply = document.getElementById('scheduleApply');
            const scheduleClear = document.getElementById('scheduleClear');
            const scheduleTableBody = document.getElementById('scheduleTableBody');

            function applyScheduleFilters() {
                const q = (scheduleSearch?.value || '').toLowerCase().trim();
                const s = scheduleStatus?.value || '';
                const r = scheduleRange?.value || '';
                const now = new Date();
                const future30 = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);
                const future90 = new Date(now.getTime() + 90 * 24 * 60 * 60 * 1000);

                document.querySelectorAll('.schedule-item').forEach(item => {
                    const text = (item.getAttribute('data-text') || '').toLowerCase();
                    const status = item.getAttribute('data-status') || '';
                    const prevFim = item.querySelector('td:nth-child(6)')?.textContent || '';
                    const fimDate = prevFim ? new Date(prevFim.split('/').reverse().join('-')) : null;

                    let show = true;
                    if (q && !text.includes(q)) show = false;
                    if (s && status !== s) show = false;
                    if (r === '30' && fimDate && fimDate > future30) show = false;
                    if (r === '90' && fimDate && fimDate > future90) show = false;

                    item.style.display = show ? '' : 'none';
                });

                // Hide empty state if there are visible items
                const visibleItems = document.querySelectorAll('.schedule-item:not([style*="display: none"])');
                document.querySelector('.empty-state').style.display = visibleItems.length > 0 ? 'none' : '';
            }

            scheduleApply?.addEventListener('click', applyScheduleFilters);
            scheduleClear?.addEventListener('click', () => {
                if (scheduleSearch) scheduleSearch.value = '';
                if (scheduleStatus) scheduleStatus.value = '';
                if (scheduleRange) scheduleRange.value = '';
                applyScheduleFilters();
            });

            // Edit button: Populate modal
            document.addEventListener('click', function(e) {
                if (e.target.closest('.edit-btn')) {
                    const btn = e.target.closest('.edit-btn');
                    const data = JSON.parse(btn.getAttribute('data-row'));
                    document.getElementById('editMarco').value = data.marco;
                    document.getElementById('editAtividade').value = data.atividade;
                    document.getElementById('editResponsavel').value = data.responsavel;
                    document.getElementById('editDuracao').value = data.duracao;
                    document.getElementById('editPrevInicio').value = data.prevInicio ? data.prevInicio.split('/').reverse().join('-') : '';
                    document.getElementById('editPrevFim').value = data.prevFim ? data.prevFim.split('/').reverse().join('-') : '';
                    document.getElementById('editInicioReal').value = data.inicioReal ? data.inicioReal.split('/').reverse().join('-') : '';
                    document.getElementById('editFimReal').value = data.fimReal ? data.fimReal.split('/').reverse().join('-') : '';
                    document.getElementById('editPercent').value = data.percent;
                }
            });

            // Add new row (dynamic addition)
            document.getElementById('btnSalvarAdicionar')?.addEventListener('click', function() {
                const marco = document.getElementById('addMarco').value.trim();
                const atividade = document.getElementById('addAtividade').value.trim();
                const responsavel = document.getElementById('addResponsavel').value.trim();
                const duracao = document.getElementById('addDuracao').value;
                const prevInicio = document.getElementById('addPrevInicio').value;
                const prevFim = document.getElementById('addPrevFim').value;
                const inicioReal = document.getElementById('addInicioReal').value;
                const fimReal = document.getElementById('addFimReal').value;
                const percent = document.getElementById('addPercent').value;

                if (!marco || !atividade || !responsavel || !duracao || !prevInicio || !prevFim) {
                    alert('Preencha todos os campos obrigatórios.');
                    return;
                }

                // Format dates to DD/MM/YYYY
                const formatDate = (dateStr) => dateStr ? new Date(dateStr).toLocaleDateString('pt-BR') : '';

                const prevInicioFormatted = formatDate(prevInicio);
                const prevFimFormatted = formatDate(prevFim);
                const inicioRealFormatted = formatDate(inicioReal);
                const fimRealFormatted = formatDate(fimReal);

                // Determine status based on dates and percent
                let status = 'future';
                if (percent == 100) status = 'done';
                else if (inicioRealFormatted) status = 'ongoing';

                const dataText = `${marco} ${atividade} ${responsavel}`.toLowerCase();
                const dataRow = JSON.stringify({
                    marco, atividade, responsavel, duracao, prevInicio: prevInicioFormatted, prevFim: prevFimFormatted,
                    inicioReal: inicioRealFormatted, fimReal: fimRealFormatted, percent
                });

                const newRow = `
                    <tr class="schedule-item" data-status="${status}" data-text="${dataText}">
                        <td>${marco}</td>
                        <td>${atividade}</td>
                        <td>${responsavel}</td>
                        <td class="text-end">${duracao}</td>
                        <td>${prevInicioFormatted}</td>
                        <td>${prevFimFormatted}</td>
                        <td>${inicioRealFormatted || '—'}</td>
                        <td>${fimRealFormatted || '—'}</td>
                        <td class="text-end">${percent}</td>
                        <td class="text-center">
                            <div class="d-flex justify-content-center gap-1">
                                <a href="#" class="btn btn-light btn-icon btn-sm rounded-circle edit-btn" data-bs-toggle="modal" data-bs-target="#modalEditarLinha" data-row='${dataRow}'>
                                    <i class="ti ti-pencil fs-lg"></i>
                                </a>
                                <a href="#" class="btn btn-light btn-icon btn-sm rounded-circle delete-btn" data-bs-toggle="modal" data-bs-target="#modalConfirmarExclusao">
                                    <i class="ti ti-trash fs-lg"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                `;

                // Insert before empty state
                const tbody = document.getElementById('scheduleTableBody');
                const emptyState = tbody.querySelector('.empty-state');
                emptyState.insertAdjacentHTML('beforebegin', newRow);

                // Update timeline
                updateTimeline(marco, prevInicioFormatted, prevFimFormatted, percent, status);

                // Clear form and close modal
                document.getElementById('formAdicionarLinha').reset();
                const modal = bootstrap.Modal.getInstance(document.getElementById('modalAdicionarLinha'));
                modal.hide();

                // Reapply filters
                applyScheduleFilters();
            });

            // Function to update timeline
            function updateTimeline(marco, prevInicio, prevFim, percent, status) {
                const timeline = document.querySelector('.vertical-timeline');
                let existingItem = Array.from(timeline.querySelectorAll('.timeline-item')).find(item =>
                    item.querySelector('.timeline-content .fw-semibold').textContent.includes(marco)
                );

                if (existingItem) {
                    // Update existing: simple average progress (prototype logic)
                    const progressBar = existingItem.querySelector('.progress-bar');
                    const currentWidth = parseInt(progressBar.style.width) || 0;
                    const newWidth = Math.round((currentWidth + parseInt(percent)) / 2); // Average
                    progressBar.style.width = `${newWidth}%`;
                    progressBar.className = `progress-bar bg-${status === 'done' ? 'success' : status === 'ongoing' ? 'warning' : 'secondary'}`;
                    existingItem.querySelector('.timeline-marker').className = `timeline-marker ${status}`;
                } else {
                    // Add new item
                    const newItem = `
                        <div class="timeline-item">
                            <div class="timeline-marker ${status}"></div>
                            <div class="timeline-content">
                                <div class="fw-semibold">Marco: ${marco}</div>
                                <div class="text-muted fs-12">${prevInicio} → ${prevFim}</div>
                                <div class="progress mt-1" style="height: 6px;">
                                    <div class="progress-bar bg-${status === 'done' ? 'success' : status === 'ongoing' ? 'warning' : 'secondary'}" style="width: ${percent}%"></div>
                                </div>
                            </div>
                        </div>
                    `;
                    timeline.insertAdjacentHTML('beforeend', newItem);
                }
            }

            // Save edit (simple UI simulation)
            document.getElementById('btnSalvarEditar')?.addEventListener('click', function() {
                alert('Alterações salvas (simulação).');
            });

            // Initial setup
            hideAllSections();
            applyScheduleFilters();
        })();
    </script>

    <style>
        .vertical-timeline {
            position: relative;
            padding-left: 30px;
        }
        .vertical-timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e9ecef;
        }
        .timeline-item {
            position: relative;
            margin-bottom: 20px;
        }
        .timeline-marker {
            position: absolute;
            left: -22px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid #fff;
        }
        .timeline-marker.done { background: #198754; }
        .timeline-marker.ongoing { background: #ffc107; }
        .timeline-marker.future { background: #6c757d; }
        .timeline-content {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            border-left: 3px solid #dee2e6;
        }
    </style>

</body>

</html>
